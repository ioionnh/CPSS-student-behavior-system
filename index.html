<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบบันทึกคะแนนพฤติกรรมนักเรียน</title>
    <style>
        /* Reset และ Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Kanit', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            min-height: 100vh;
            color: #2c3e50;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 15px;
            width: 100%;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            color: white;
            padding: 25px 15px;
            text-align: center;
            border-radius: 15px 15px 0 0;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            margin-bottom: 10px;
        }
        
        /* ปุ่ม Styles */
        .btn {
            display: inline-block;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-decoration: none;
            margin: 3px;
            white-space: nowrap;
            text-align: center;
            min-width: 80px;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }
        
        .btn-login {
            background: linear-gradient(135deg, #4cc9f0 0%, #4895ef 100%);
        }
        
        .btn-login.active {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            animation: pulse 0.5s;
        }
        
        .btn-logout {
            background: linear-gradient(135deg, #f72585 0%, #b5179e 100%);
        }
        
        .btn-add {
            background: linear-gradient(135deg, #4cc9f0 0%, #4895ef 100%);
        }
        
        .btn-remove {
            background: linear-gradient(135deg, #f72585 0%, #7209b7 100%);
        }
        
        .btn-edit {
            background: linear-gradient(135deg, #f8961e 0%, #f3722c 100%);
        }

        .btn-increase {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }
        
        .btn-decrease {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .btn-approve {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }
        
        .btn-reject {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        /* เพิ่มสไตล์สำหรับกลุ่มปุ่ม */
        .btn-group {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        /* Panel Styles */
        .panel {
            display: none;
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .panel-title {
            font-size: 1.5rem;
            color: #3a0ca3;
        }
        
        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            table-layout: auto;
        }
        
        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid #eee;
            word-wrap: break-word;
        }
        
        th {
            background: #3a0ca3;
            color: white;
            font-weight: 500;
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            position: relative;
        }
        
        .close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            color: #aaa;
            cursor: pointer;
        }
        
        .close:hover {
            color: #333;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            border-color: #4361ee;
            outline: none;
        }
        
        /* Score Controls */
        .score-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .score-input {
            flex: 1;
        }
        
        /* Login Section */
        .login-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            max-width: 500px;
            margin: 0 auto;
        }
        
        /* Tab Styles */
        .tab-container {
            margin-top: 20px;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .tab-btn {
            padding: 10px 15px;
            background: #eee;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px 5px 0 0;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            background: #3a0ca3;
            color: white;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            background: white;
            border-radius: 0 5px 5px 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* GitHub-like Accordion */
        .accordion {
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        .accordion-header {
            background-color: #f6f8fa;
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
        }
        
        .accordion-header:hover {
            background-color: #eaeef2;
        }
        
        .accordion-content {
            padding: 15px;
            background: white;
        }
        
        .accordion-icon {
            transition: transform 0.3s;
        }
        
        .accordion.active .accordion-icon {
            transform: rotate(90deg);
        }
        
        /* Request Status */
        .status-pending {
            color: #f39c12;
            font-weight: bold;
        }
        
        .status-approved {
            color: #2ecc71;
            font-weight: bold;
        }
        
        .status-rejected {
            color: #e74c3c;
            font-weight: bold;
        }
        
        /* Responsive Styles */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 0.85rem;
                min-width: 70px;
            }
            
            .btn-group {
                flex-direction: column;
                gap: 5px;
            }
            
            .score-controls {
                flex-direction: column;
            }
            
            th, td {
                padding: 8px 5px;
                font-size: 0.9rem;
            }
        }
        
        /* Custom Styles */
        .positive { color: #2ecc71; font-weight: bold; }
        .negative { color: #e74c3c; font-weight: bold; }
        .log-entry {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>ระบบบันทึกคะแนนพฤติกรรมนักเรียน</h1>
            </div>
        </header>

        <!-- Login Section -->
        <div class="login-container" id="loginSection">
            <h2 style="text-align: center; margin-bottom: 20px;">เข้าสู่ระบบ</h2>
            <div class="form-group">
                <label for="username"><strong>ชื่อผู้ใช้</strong></label>
                <input type="text" id="username" class="form-control" placeholder="กรอกรหัสผู้ใช้">
            </div>
            <div class="form-group">
                <label for="password"><strong>รหัสผ่าน</strong></label>
                <input type="password" id="password" class="form-control" placeholder="กรอกรหัสผ่าน">
            </div>
            <button class="btn btn-login" id="loginBtn" onclick="login()" style="width: 100%;">เข้าสู่ระบบ</button>
        </div>

        <!-- Student Panel -->
        <div class="panel" id="studentPanel">
            <div class="panel-header">
                <h2 class="panel-title">คะแนนพฤติกรรมของฉัน</h2>
                <button class="btn btn-logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i> ออกจากระบบ</button>
            </div>
            <div id="studentInfo"></div>
            <table id="studentScoreTable">
                <thead>
                    <tr>
                        <th style="width: 20%;">วันที่</th>
                        <th style="width: 40%;">รายการ</th>
                        <th style="width: 20%;">คะแนนที่เปลี่ยนแปลง</th>
                        <th style="width: 20%;">โดย</th>
                    </tr>
                </thead>
                <tbody id="studentScoreBody">
                </tbody>
            </table>
            <div id="studentTotalScore" style="text-align: center; margin-top: 20px;"></div>
        </div>

        <!-- Teacher Panel -->
        <div class="panel" id="teacherPanel">
            <div class="panel-header">
                <h2 class="panel-title">จัดการคะแนนนักเรียน</h2>
                <div>
                    <button class="btn btn-logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i> ออกจากระบบ</button>
                </div>
            </div>
            
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="openTeacherTab('teacherStudents')">นักเรียน</button>
                    <button class="tab-btn" onclick="openTeacherTab('teacherPendingRequests')">คำขอที่รอการอนุมัติ</button>
                </div>
                
                <div id="teacherStudents" class="tab-content active">
                    <table id="teacherStudentTable">
                        <thead>
                            <tr>
                                <th style="width: 15%;">รหัสนักเรียน</th>
                                <th style="width: 30%;">ชื่อนักเรียน</th>
                                <th style="width: 15%;">ระดับชั้น</th>
                                <th style="width: 15%;">คะแนนรวม</th>
                                <th style="width: 25%;">การดำเนินการ</th>
                            </tr>
                        </thead>
                        <tbody id="teacherStudentBody">
                        </tbody>
                    </table>
                </div>
                
                <div id="teacherPendingRequests" class="tab-content">
                    <div id="teacherRequestsContainer">
                        <!-- คำขอลด/เพิ่มคะแนนที่รออนุมัติจะแสดงที่นี่ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Panel -->
        <div class="panel" id="adminPanel">
            <div class="panel-header">
                <h2 class="panel-title">ระบบจัดการผู้ดูแล</h2>
                <div>
                    <button class="btn btn-add" onclick="openAddUserModal()"><i class="fas fa-user-plus"></i> เพิ่มผู้ใช้</button>
                    <button class="btn btn-logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i> ออกจากระบบ</button>
                </div>
            </div>
            
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="openTab('adminStudents')">นักเรียน</button>
                    <button class="tab-btn" onclick="openTab('adminTeachers')">ครู</button>
                    <button class="tab-btn" onclick="openTab('adminPendingRequests')">คำขอที่รออนุมัติ</button>
                    <button class="tab-btn" onclick="openTab('adminLogs')">ประวัติการเปลี่ยนแปลง</button>
                </div>
                
                <div id="adminStudents" class="tab-content active">
                    <table id="adminStudentTable">
                        <thead>
                            <tr>
                                <th style="width: 15%;">รหัสนักเรียน</th>
                                <th style="width: 30%;">ชื่อนักเรียน</th>
                                <th style="width: 15%;">ระดับชั้น</th>
                                <th style="width: 15%;">คะแนนรวม</th>
                                <th style="width: 25%;">การดำเนินการ</th>
                            </tr>
                        </thead>
                        <tbody id="adminStudentBody">
                        </tbody>
                    </table>
                </div>
                
                <div id="adminTeachers" class="tab-content">
                    <table id="adminTeacherTable">
                        <thead>
                            <tr>
                                <th style="width: 30%;">รหัสครู</th>
                                <th style="width: 50%;">ชื่อครู</th>
                                <th style="width: 20%;">การดำเนินการ</th>
                            </tr>
                        </thead>
                        <tbody id="adminTeacherBody">
                        </tbody>
                    </table>
                </div>
                
                <div id="adminPendingRequests" class="tab-content">
                    <div id="adminRequestsContainer">
                        <!-- คำขอลด/เพิ่มคะแนนที่รออนุมัติจะแสดงที่นี่ -->
                    </div>
                </div>
                
                <div id="adminLogs" class="tab-content">
                    <div id="adminLogsContainer" style="max-height: 500px; overflow-y: auto;">
                        <!-- Log entries will be added here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Score Modal -->
        <div id="addScoreModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('addScoreModal')">&times;</span>
                <h2 style="margin-bottom: 20px;">เพิ่ม/ลดคะแนนนักเรียน</h2>
                <div class="form-group">
                    <label for="scoreStudentId">นักเรียน</label>
                    <select id="scoreStudentId" class="form-control">
                        <!-- Options will be added by JavaScript -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="scoreClass">ระดับชั้น</label>
                    <select id="scoreClass" class="form-control">
                        <option value="ม.1">มัธยมศึกษาปีที่ 1</option>
                        <option value="ม.2">มัธยมศึกษาปีที่ 2</option>
                        <option value="ม.3">มัธยมศึกษาปีที่ 3</option>
                        <option value="ม.4">มัธยมศึกษาปีที่ 4</option>
                        <option value="ม.5">มัธยมศึกษาปีที่ 5</option>
                        <option value="ม.6">มัธยมศึกษาปีที่ 6</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>จำนวนคะแนน</label>
                    <div class="score-controls">
                        <button class="btn btn-increase" onclick="setScoreValue(1)"><i class="fas fa-plus"></i> เพิ่ม</button>
                        <button class="btn btn-decrease" onclick="setScoreValue(-1)"><i class="fas fa-minus"></i> ลด</button>
                        <input type="number" id="scoreChange" class="form-control score-input" placeholder="เช่น 5 หรือ -3" value="1">
                    </div>
                </div>
                <div class="form-group">
                    <label for="scoreReason">เหตุผล</label>
                    <input type="text" id="scoreReason" class="form-control" placeholder="เช่น มาโรงเรียนสาย, ช่วยเหลือเพื่อน">
                </div>
                <button class="btn" onclick="submitScoreRequest()"><i class="fas fa-paper-plane"></i> ส่งคำขอ</button>
            </div>
        </div>

        <!-- Add User Modal -->
        <div id="addUserModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('addUserModal')">&times;</span>
                <h2 style="margin-bottom: 20px;">เพิ่มผู้ใช้ใหม่</h2>
                <div class="form-group">
                    <label for="newUserType">ประเภทผู้ใช้</label>
                    <select id="newUserType" class="form-control">
                        <option value="student">นักเรียน</option>
                        <option value="teacher">ครู</option>
                        <option value="admin">ผู้บริหาร</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newUserId">รหัสผู้ใช้</label>
                    <input type="text" id="newUserId" class="form-control" placeholder="เช่น 64001 สำหรับนักเรียน">
                </div>
                <div class="form-group">
                    <label for="newUserName">ชื่อ-สกุล</label>
                    <input type="text" id="newUserName" class="form-control" placeholder="ชื่อผู้ใช้">
                </div>
                <div class="form-group" id="newUserClassGroup">
                    <label for="newUserClass">ระดับชั้น (สำหรับนักเรียน)</label>
                    <select id="newUserClass" class="form-control">
                        <option value="ม.1">มัธยมศึกษาปีที่ 1</option>
                        <option value="ม.2">มัธยมศึกษาปีที่ 2</option>
                        <option value="ม.3">มัธยมศึกษาปีที่ 3</option>
                        <option value="ม.4">มัธยมศึกษาปีที่ 4</option>
                        <option value="ม.5">มัธยมศึกษาปีที่ 5</option>
                        <option value="ม.6">มัธยมศึกษาปีที่ 6</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newUserPassword">รหัสผ่าน</label>
                    <input type="password" id="newUserPassword" class="form-control" placeholder="รหัสผ่าน">
                </div>
                <button class="btn" onclick="addNewUser()"><i class="fas fa-user-plus"></i> เพิ่มผู้ใช้</button>
            </div>
        </div>

        <!-- Edit User Modal -->
        <div id="editUserModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('editUserModal')">&times;</span>
                <h2 style="margin-bottom: 20px;">แก้ไขข้อมูลผู้ใช้</h2>
                <div class="form-group">
                    <label for="editUserId">รหัสผู้ใช้</label>
                    <input type="text" id="editUserId" class="form-control" disabled>
                </div>
                <div class="form-group">
                    <label for="editUserName">ชื่อ-สกุล</label>
                    <input type="text" id="editUserName" class="form-control">
                </div>
                <div class="form-group" id="editUserClassGroup">
                    <label for="editUserClass">ระดับชั้น</label>
                    <select id="editUserClass" class="form-control">
                        <option value="ม.1">มัธยมศึกษาปีที่ 1</option>
                        <option value="ม.2">มัธยมศึกษาปีที่ 2</option>
                        <option value="ม.3">มัธยมศึกษาปีที่ 3</option>
                        <option value="ม.4">มัธยมศึกษาปีที่ 4</option>
                        <option value="ม.5">มัธยมศึกษาปีที่ 5</option>
                        <option value="ม.6">มัธยมศึกษาปีที่ 6</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editUserPassword">รหัสผ่านใหม่ (เว้นว่างหากไม่ต้องการเปลี่ยน)</label>
                    <input type="password" id="editUserPassword" class="form-control">
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                    <button class="btn btn-edit" onclick="updateUser()"><i class="fas fa-save"></i> บันทึกการเปลี่ยนแปลง</button>
                    <button class="btn btn-remove" onclick="deleteUser()"><i class="fas fa-trash"></i> ลบผู้ใช้นี้</button>
                </div>
            </div>
        </div>

        <!-- Request Approval Modal -->
        <div id="approvalModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('approvalModal')">&times;</span>
                <h2 style="margin-bottom: 20px;">อนุมัติคำขอเปลี่ยนแปลงคะแนน</h2>
                <div id="requestDetails"></div>
                <div class="form-group">
                    <label for="approvalComment">ความคิดเห็น (ไม่จำเป็น)</label>
                    <textarea id="approvalComment" class="form-control" rows="3" placeholder="เพิ่มความคิดเห็น..."></textarea>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                    <button class="btn btn-approve" onclick="approveRequest(true)"><i class="fas fa-check"></i> อนุมัติ</button>
                    <button class="btn btn-reject" onclick="approveRequest(false)"><i class="fas fa-times"></i> ไม่อนุมัติ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ระบบเก็บข้อมูลแบบถาวร
        const STORAGE_KEY = 'studentBehaviorSystemData';
        
        // ข้อมูลเริ่มต้น
        const defaultData = {
            users: [
                { id: "64001", name: "นักเรียน หนึ่ง", password: "64001", role: "student", class: "ม.1", score: -410, logs: [
                    { date: "2023-05-01T09:00:00", change: 5, by: "ครู สมชาย", reason: "ช่วยเหลือเพื่อน", status: "approved" },
                    { date: "2023-05-03T10:30:00", change: -2, by: "ครู สมหญิง", reason: "ส่งงานช้า", status: "approved" },
                    { date: "2023-05-05T08:15:00", change: -413, by: "ครู สมชาย", reason: "ขาดเรียนหลายครั้ง", status: "approved" }
                ]},
                { id: "64002", name: "นักเรียน สอง", password: "64002", role: "student", class: "ม.2", score: 77, logs: [
                    { date: "2023-05-02T08:45:00", change: -5, by: "ครู สมหญิง", reason: "มาโรงเรียนสาย", status: "approved" },
                    { date: "2023-05-04T14:15:00", change: 2, by: "ครู สมชาย", reason: "ตอบคำถามในชั้นเรียน", status: "approved" },
                    { date: "2023-05-06T09:30:00", change: 80, by: "ครู สมหญิง", reason: "ชนะการแข่งขันวิชาการ", status: "approved" }
                ]},
                { id: "64003", name: "นักเรียน สาม", password: "64003", role: "student", class: "ม.3", score: 90, logs: [
                    { date: "2023-05-01T11:20:00", change: 3, by: "ครู สมชาย", reason: "ทำงานกลุ่มดี", status: "approved" },
                    { date: "2023-05-06T13:10:00", change: 4, by: "ครู สมห��ิง", reason: "ช่วยครูยกของ", status: "approved" },
                    { date: "2023-05-08T10:00:00", change: -7, by: "ครู สมชาย", reason: "ไม่ส่งงาน", status: "approved" }
                ]},
                { id: "64004", name: "นักเรียน สี่", password: "64004", role: "student", class: "ม.4", score: 68, logs: [
                    { date: "2023-05-03T10:00:00", change: -3, by: "ครู สมชาย", reason: "ไม่ทำการบ้าน", status: "approved" },
                    { date: "2023-05-07T09:30:00", change: -2, by: "ครู สมหญิง", reason: "พูดคุยในชั้นเรียน", status: "approved" },
                    { date: "2023-05-09T14:00:00", change: 73, by: "ครู สมหญิง", reason: "พัฒนาการดีขึ้น", status: "approved" }
                ]},
                { id: "64005", name: "นักเรียน ห้า", password: "64005", role: "student", class: "ม.5", score: 77, logs: [
                    { date: "2023-05-02T15:00:00", change: 5, by: "ครู สมหญิง", reason: "ชนะการแข่งขัน", status: "approved" },
                    { date: "2023-05-05T08:20:00", change: -1, by: "ครู สมชาย", reason: "ลืมอุปกรณ์", status: "approved" },
                    { date: "2023-05-07T11:45:00", change: 73, by: "ครู สมชาย", reason: "มีน้ำใจช่วยเหลือเพื่อน", status: "approved" }
                ]},
                { id: "t001", name: "ครู สมชาย", password: "t001", role: "teacher" },
                { id: "t002", name: "ครู สมหญิง", password: "t002", role: "teacher" },
                { id: "admin", name: "ผู้บริหาร ใหญ่", password: "admin", role: "admin" }
            ],
            allLogs: [],
            pendingRequests: []
        };

        // โหลดข้อมูลจาก localStorage
        function loadData() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (!savedData) {
                // สร้างข้อมูลเริ่มต้นและบันทึก
                initializeSampleLogs();
                return defaultData;
            }
            return JSON.parse(savedData);
        }

        // บันทึกข้อมูล
        function saveData(data) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        // เริ่มต้นข้อมูลตัวอย่าง
        function initializeSampleLogs() {
            defaultData.allLogs = [];
            defaultData.users.forEach(user => {
                if (user.role === 'student' && user.logs) {
                    user.logs.forEach(log => {
                        defaultData.allLogs.push({
                            date: log.date,
                            studentId: user.id,
                            studentName: user.name,
                            studentClass: user.class,
                            change: log.change,
                            by: log.by,
                            reason: log.reason,
                            actionBy: log.by.split(' ')[1], // แยกรหัสครูจากชื่อ
                            status: log.status
                        });
                    });
                }
            });
            saveData(defaultData);
        }

        // ตัวแปรระบบ
        let users = [];
        let allLogs = [];
        let pendingRequests = [];
        let currentUser = null;
        let selectedRequestId = null;

        // โหลดข้อมูลเมื่อเริ่มต้น
        function initializeSystem() {
            const data = loadData();
            users = data.users;
            allLogs = data.allLogs;
            pendingRequests = data.pendingRequests || [];
        }

        // เข้าสู่ระบบ
        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                alert('กรุณากรอกชื่อผู้ใช้และรหัสผ่าน!');
                return;
            }
            
            // กระพริบปุ่มเมื่อคลิก
            const loginBtn = document.getElementById('loginBtn');
            loginBtn.classList.add('active');
            setTimeout(() => loginBtn.classList.remove('active'), 500);
            
            currentUser = users.find(user => user.id === username && user.password === password);
            
            if (currentUser) {
                document.getElementById('loginSection').style.display = 'none';
                
                // บันทึกเวลาการเข้าสู่ระบบ
                currentUser.lastLogin = new Date().toISOString();
                saveData({ users, allLogs, pendingRequests });
                
                // เรียกฟังก์ชันแสดงแผงตามบทบาท
                const panels = {
                    'student': showStudentPanel,
                    'teacher': showTeacherPanel,
                    'admin': showAdminPanel
                };
                panels[currentUser.role]();
            } else {
                alert('ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง!');
            }
        }

        // ออกจากระบบ
        function logout() {
            currentUser = null;
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('studentPanel').style.display = 'none';
            document.getElementById('teacherPanel').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // แสดงแผงนักเรียน
        function showStudentPanel() {
            const panel = document.getElementById('studentPanel');
            panel.style.display = 'block';
            
            document.getElementById('studentInfo').innerHTML = `
                <p><strong>รหัสนักเรียน:</strong> ${currentUser.id}</p>
                <p><strong>ชื่อนักเรียน:</strong> ${currentUser.name}</p>
                ${currentUser.class ? `<p><strong>ระดับชั้น:</strong> ${currentUser.class}</p>` : ''}
            `;
            
            const tbody = document.getElementById('studentScoreBody');
            tbody.innerHTML = '';
            
            if (currentUser.logs && currentUser.logs.length > 0) {
                currentUser.logs.forEach(log => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${formatDate(log.date)}</td>
                        <td>${log.reason}</td>
                        <td class="${log.change > 0 ? 'positive' : 'negative'}">
                            ${log.change > 0 ? '+' : ''}${log.change}
                        </td>
                        <td>${log.by}</td>
                    `;
                    tbody.appendChild(row);
                });
            } else {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="4" style="text-align: center;">ไม่มีประวัติการเปลี่ยนแปลงคะแนน</td>`;
                tbody.appendChild(row);
            }
            
            document.getElementById('studentTotalScore').innerHTML = `
                <h3>คะแนนรวม: <span class="${currentUser.score > 0 ? 'positive' : 'negative'}">${currentUser.score}</span></h3>
            `;
        }

        // แสดงแผงครู
        function showTeacherPanel() {
            const panel = document.getElementById('teacherPanel');
            panel.style.display = 'block';
            
            // แสดงแท็บนักเรียน
            openTeacherTab('teacherStudents');
        }

        // เปิดแท็บครู
        function openTeacherTab(tabName) {
            // ซ่อนแท็บทั้งหมด
            document.querySelectorAll('#teacherPanel .tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ยกเลิกการเลือกปุ่มแท็บทั้งหมด
            document.querySelectorAll('#teacherPanel .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // แสดงแท็บที่เลือก
            document.getElementById(tabName).classList.add('active');
            
            // เน้นปุ่มแท็บที่เลือก
            event.currentTarget.classList.add('active');
            
            if (tabName === 'teacherStudents') {
                loadTeacherStudents();
            } else if (tabName === 'teacherPendingRequests') {
                loadTeacherPendingRequests();
            }
        }

        // โหลดข้อมูลนักเรียนสำหรับครู
        function loadTeacherStudents() {
            const tbody = document.getElementById('teacherStudentBody');
            tbody.innerHTML = '';
            
            const students = users.filter(user => user.role === 'student');
            students.forEach(student => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.id}</td>
                    <td>${student.name}</td>
                    <td>${student.class || '-'}</td>
                    <td class="${student.score > 0 ? 'positive' : 'negative'}">${student.score}</td>
                    <td>
                        <div class="btn-group">
                            <button class="btn btn-increase" onclick="openAddScoreModal('${student.id}', true)">
                                <i class="fas fa-plus"></i> เพิ่ม
                            </button>
                            <button class="btn btn-decrease" onclick="openAddScoreModal('${student.id}', false)">
                                <i class="fas fa-minus"></i> ลด
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // โหลดคำขอที่รออนุมัติสำหรับครู
        function loadTeacherPendingRequests() {
            const container = document.getElementById('teacherRequestsContainer');
            container.innerHTML = '';
            
            const teacherRequests = pendingRequests.filter(
                req => req.requestedBy === currentUser.id
            );
            
            if (teacherRequests.length === 0) {
                container.innerHTML = '<p>ไม่มีคำขอที่รอการอนุมัติ</p>';
                return;
            }
            
            teacherRequests.forEach(request => {
                const accordion = document.createElement('div');
                accordion.className = 'accordion';
                accordion.innerHTML = `
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <span>
                            <strong>${request.studentName} (${request.studentId})</strong> - 
                            ${request.change > 0 ? '+' : ''}${request.change} คะแนน
                            <span class="status-pending">(รออนุมัติ)</span>
                        </span>
                        <i class="fas fa-chevron-right accordion-icon"></i>
                    </div>
                    <div class="accordion-content">
                        <p><strong>เหตุผล:</strong> ${request.reason}</p>
                        <p><strong>วันที่ส่งคำขอ:</strong> ${formatDate(request.requestDate)}</p>
                        <p><strong>ระดับชั้น:</strong> ${request.studentClass}</p>
                        <div class="btn-group" style="margin-top: 10px;">
                            <button class="btn btn-edit" onclick="editRequest('${request.id}')">
                                <i class="fas fa-edit"></i> แก้ไข
                            </button>
                            <button class="btn btn-remove" onclick="cancelRequest('${request.id}')">
                                <i class="fas fa-trash"></i> ยกเลิก
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(accordion);
            });
        }

        // แสดงแผงผู้ดูแล
        function showAdminPanel() {
            const panel = document.getElementById('adminPanel');
            panel.style.display = 'block';
            
            // แสดงแท็บนักเรียน
            openTab('adminStudents');
        }

        // เปิดแท็บ
        function openTab(tabName) {
            // ซ่อนแท็บทั้งหมด
            document.querySelectorAll('#adminPanel .tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ยกเลิกการเลือกปุ่มแท็บทั้งหมด
            document.querySelectorAll('#adminPanel .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // แสดงแท็บที่เลือก
            document.getElementById(tabName).classList.add('active');
            
            // เน้นปุ่มแท็บที่เลือก
            event.currentTarget.classList.add('active');
            
            if (tabName === 'adminStudents') {
                loadAdminStudents();
            } else if (tabName === 'adminTeachers') {
                loadAdminTeachers();
            } else if (tabName === 'adminPendingRequests') {
                loadAdminPendingRequests();
            } else if (tabName === 'adminLogs') {
                loadAdminLogs();
            }
        }

        // โหลดข้อมูลนักเรียนสำหรับผู้ดูแล
        function loadAdminStudents() {
            const tbody = document.getElementById('adminStudentBody');
            tbody.innerHTML = '';
            
            const students = users.filter(user => user.role === 'student');
            students.forEach(student => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.id}</td>
                    <td>${student.name}</td>
                    <td>${student.class || '-'}</td>
                    <td class="${student.score > 0 ? 'positive' : 'negative'}">${student.score}</td>
                    <td>
                        <button class="btn btn-edit" onclick="editUser('${student.id}')">
                            <i class="fas fa-edit"></i> แก้ไข
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // โหลดข้อมูลครูสำหรับผู้ดูแล
        function loadAdminTeachers() {
            const tbody = document.getElementById('adminTeacherBody');
            tbody.innerHTML = '';
            
            const teachers = users.filter(user => user.role === 'teacher');
            teachers.forEach(teacher => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${teacher.id}</td>
                    <td>${teacher.name}</td>
                    <td>
                        <button class="btn btn-edit" onclick="editUser('${teacher.id}')">
                            <i class="fas fa-edit"></i> แก้ไข
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // โหลดคำขอที่รออนุมัติสำหรับผู้ดูแล
        function loadAdminPendingRequests() {
            const container = document.getElementById('adminRequestsContainer');
            container.innerHTML = '';
            
            if (pendingRequests.length === 0) {
                container.innerHTML = '<p>ไม่มีคำขอที่รอการอนุมัติ</p>';
                return;
            }
            
            pendingRequests.forEach(request => {
                const accordion = document.createElement('div');
                accordion.className = 'accordion';
                accordion.innerHTML = `
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <span>
                            <strong>${request.studentName} (${request.studentId})</strong> - 
                            ${request.change > 0 ? '+' : ''}${request.change} คะแนน
                            <span class="status-pending">(รออนุมัติ)</span>
                        </span>
                        <i class="fas fa-chevron-right accordion-icon"></i>
                    </div>
                    <div class="accordion-content">
                        <p><strong>ครูผู้ขอ:</strong> ${request.teacherName}</p>
                        <p><strong>เหตุผล:</strong> ${request.reason}</p>
                        <p><strong>วันที่ส่งคำขอ:</strong> ${formatDate(request.requestDate)}</p>
                        <p><strong>ระดับชั้น:</strong> ${request.studentClass}</p>
                        <div class="btn-group" style="margin-top: 10px;">
                            <button class="btn btn-approve" onclick="openApprovalModal('${request.id}')">
                                <i class="fas fa-check"></i> อนุมัติ
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(accordion);
            });
        }

        // โหลดประวัติการเปลี่ยนแปลง
        function loadAdminLogs() {
            const logsContainer = document.getElementById('adminLogsContainer');
            logsContainer.innerHTML = '';
            
            if (allLogs.length > 0) {
                allLogs.sort((a, b) => new Date(b.date) - new Date(a.date))
                    .forEach(log => {
                    const logEntry = document.createElement('div');
                    logEntry.className = 'log-entry';
                    logEntry.innerHTML = `
                        <p><strong>${formatDate(log.date)}</strong></p>
                        <p>นักเรียน: ${log.studentName} (${log.studentId}) ${log.studentClass ? 'ชั้น ' + log.studentClass : ''}</p>
                        <p>คะแนนที่เปลี่ยนแปลง: 
                            <span class="${log.change > 0 ? 'positive' : 'negative'}">
                                ${log.change > 0 ? '+' : ''}${log.change}
                            </span>
                        </p>
                        <p>เหตุผล: ${log.reason}</p>
                        <p>โดย: ${log.by}</p>
                        <p>สถานะ: <span class="status-${log.status || 'approved'}">${
                            log.status === 'approved' ? 'อนุมัติ' : 
                            log.status === 'rejected' ? 'ไม่อนุมัติ' : 'เสร็จสิ้น'
                        }</span></p>
                        <hr style="margin: 10px 0; border-color: #eee;">
                    `;
                    logsContainer.appendChild(logEntry);
                });
            } else {
                logsContainer.innerHTML = "<p>ไม่มีประวัติการเปลี่ยนแปลงคะแนน</p>";
            }
        }

        // เปิดโมดอลเพิ่ม/ลดคะแนน
        function openAddScoreModal(studentId = null, isIncrease = true) {
            const modal = document.getElementById('addScoreModal');
            const select = document.getElementById('scoreStudentId');
            select.innerHTML = '';
            
            const students = users.filter(user => user.role === 'student');
            students.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = `${student.name} (${student.id}) ${student.class ? 'ชั้น ' + student.class : ''}`;
                if (studentId && student.id === studentId) {
                    option.selected = true;
                    // ตั้งค่าระดับชั้นตามนักเรียนที่เลือก
                    document.getElementById('scoreClass').value = student.class || 'ม.1';
                }
                select.appendChild(option);
            });
            
            // ตั้งค่าค่าเริ่มต้นตามการเพิ่มหรือลดคะแนน
            document.getElementById('scoreChange').value = isIncrease ? '1' : '-1';
            document.getElementById('scoreReason').value = '';
            modal.style.display = 'flex';
        }

        // ตั้งค่าค่าคะแนน
        function setScoreValue(value) {
            const scoreInput = document.getElementById('scoreChange');
            const currentValue = parseInt(scoreInput.value) || 0;
            
            // ตรวจสอบว่าไม่ให้เป็น 0 หรือติดลบเมื่อกดเพิ่ม
            if (value > 0) {
                scoreInput.value = Math.max(1, currentValue + value);
            } else {
                scoreInput.value = Math.min(-1, currentValue + value);
            }
        }

        // ส่งคำขอเปลี่ยนแปลงคะแนน
        function submitScoreRequest() {
            const studentId = document.getElementById('scoreStudentId').value;
            const change = parseInt(document.getElementById('scoreChange').value);
            const reason = document.getElementById('scoreReason').value.trim();
            const studentClass = document.getElementById('scoreClass').value;
            
            if (!studentId) {
                alert('กรุณาเลือกนักเรียน!');
                return;
            }
            
            if (isNaN(change)) {
                alert('กรุณากรอกจำนวนคะแนนเป็นตัวเลข!');
                return;
            }
            
            if (!reason || reason.length < 5) {
                alert('กรุณากรอกเหตุผลอย่างน้อย 5 ตัวอักษร!');
                return;
            }
            
            const student = users.find(user => user.id === studentId && user.role === 'student');
            if (student) {
                // สร้างคำขอใหม่
                const requestId = 'req-' + Date.now();
                const newRequest = {
                    id: requestId,
                    studentId: student.id,
                    studentName: student.name,
                    studentClass: student.class,
                    change: change,
                    reason: reason,
                    teacherName: currentUser.name,
                    requestedBy: currentUser.id,
                    requestDate: new Date().toISOString(),
                    status: 'pending'
                };
                
                pendingRequests.push(newRequest);
                saveData({ users, allLogs, pendingRequests });
                closeModal('addScoreModal');
                
                // แสดงข้อความสำเร็จ
                alert('ส่งคำขอเปลี่ยนแปลงคะแนนเรียบร้อย รอการอนุมัติจากผู้บริหาร');
                
                // รีเฟรชแผงปัจจุบัน
                if (currentUser.role === 'teacher') {
                    showTeacherPanel();
                }
            }
        }

        // เปิดโมดอลอนุมัติคำขอ
        function openApprovalModal(requestId) {
            selectedRequestId = requestId;
            const request = pendingRequests.find(req => req.id === requestId);
            if (!request) return;
            
            document.getElementById('requestDetails').innerHTML = `
                <p><strong>นักเรียน:</strong> ${request.studentName} (${request.studentId})</p>
                <p><strong>ระดับชั้น:</strong> ${request.studentClass}</p>
                <p><strong>ครูผู้ขอ:</strong> ${request.teacherName}</p>
                <p><strong>คะแนนที่เปลี่ยนแปลง:</strong> 
                    <span class="${request.change > 0 ? 'positive' : 'negative'}">
                        ${request.change > 0 ? '+' : ''}${request.change}
                    </span>
                </p>
                <p><strong>เหตุผล:</strong> ${request.reason}</p>
                <p><strong>วันที่ส่งคำขอ:</strong> ${formatDate(request.requestDate)}</p>
            `;
            
            document.getElementById('approvalComment').value = '';
            document.getElementById('approvalModal').style.display = 'flex';
        }

        // อนุมัติหรือปฏิเสธคำขอ
        function approveRequest(isApproved) {
            const requestIndex = pendingRequests.findIndex(req => req.id === selectedRequestId);
            if (requestIndex === -1) return;
            
            const request = pendingRequests[requestIndex];
            const comment = document.getElementById('approvalComment').value.trim();
            
            if (isApproved) {
                // หานักเรียนและอัปเดตคะแนน
                const student = users.find(user => user.id === request.studentId && user.role === 'student');
                if (student) {
                    student.score += request.change;
                    
                    // บันทึกประวัติ
                    const logEntry = {
                        date: new Date().toISOString(),
                        change: request.change,
                        by: request.teacherName,
                        reason: request.reason,
                        status: 'approved'
                    };
                    
                    if (!student.logs) student.logs = [];
                    student.logs.push(logEntry);
                    
                    // เพิ่มในประวัติทั้งหมด
                    allLogs.push({
                        date: logEntry.date,
                        studentId: student.id,
                        studentName: student.name,
                        studentClass: student.class,
                        change: request.change,
                        by: request.teacherName,
                        reason: request.reason,
                        actionBy: currentUser.id,
                        status: 'approved',
                        comment: comment
                    });
                }
            } else {
                // เพิ่มในประวัติการปฏิเสธ
                allLogs.push({
                    date: new Date().toISOString(),
                    studentId: request.studentId,
                    studentName: request.studentName,
                    studentClass: request.studentClass,
                    change: request.change,
                    by: request.teacherName,
                    reason: request.reason,
                    actionBy: currentUser.id,
                    status: 'rejected',
                    comment: comment
                });
            }
            
            // ลบคำขอออกจากรายการรออนุมัติ
            pendingRequests.splice(requestIndex, 1);
            
            saveData({ users, allLogs, pendingRequests });
            closeModal('approvalModal');
            
            // รีเฟรชแผง
            if (currentUser.role === 'admin') {
                loadAdminPendingRequests();
                loadAdminLogs();
            }
            
            alert(`คำขอได้รับการ${isApproved ? 'อนุมัติ' : 'ปฏิเสธ'}เรียบร้อย`);
        }

        // แก้ไขคำขอ
        function editRequest(requestId) {
            const request = pendingRequests.find(req => req.id === requestId);
            if (!request) return;
            
            // เปิดโมดอลแก้ไขคำขอ
            openAddScoreModal(request.studentId, request.change > 0);
            
            // ตั้งค่าข้อมูลเดิม
            document.getElementById('scoreChange').value = request.change;
            document.getElementById('scoreReason').value = request.reason;
            
            // ลบคำขอเดิม
            pendingRequests = pendingRequests.filter(req => req.id !== requestId);
        }

        // ยกเลิกคำขอ
        function cancelRequest(requestId) {
            if (!confirm('คุณแน่ใจหรือไม่ว่าต้องการยกเลิกคำขอนี้?')) return;
            
            pendingRequests = pendingRequests.filter(req => req.id !== requestId);
            saveData({ users, allLogs, pendingRequests });
            
            // รีเฟรชแผง
            if (currentUser.role === 'teacher') {
                loadTeacherPendingRequests();
            } else if (currentUser.role === 'admin') {
                loadAdminPendingRequests();
            }
            
            alert('ยกเลิกคำขอเรียบร้อยแล้ว');
        }

        // เปิด/ปิด Accordion
        function toggleAccordion(header) {
            const accordion = header.parentElement;
            accordion.classList.toggle('active');
        }

        // เปิดโมดอลเพิ่มผู้ใช้
        function openAddUserModal() {
            document.getElementById('newUserType').value = 'student';
            document.getElementById('newUserId').value = '';
            document.getElementById('newUserName').value = '';
            document.getElementById('newUserClass').value = 'ม.1';
            document.getElementById('newUserPassword').value = '';
            document.getElementById('addUserModal').style.display = 'flex';
        }

        // เพิ่มผู้ใช้ใหม่
        function addNewUser() {
            const userType = document.getElementById('newUserType').value;
            const userId = document.getElementById('newUserId').value.trim();
            const userName = document.getElementById('newUserName').value.trim();
            const password = document.getElementById('newUserPassword').value;
            const userClass = document.getElementById('newUserClass').value;
            
            if (!userId || !userName || !password) {
                alert('กรุณากรอกข้อมูลให้ครบถ้วน!');
                return;
            }
            
            if (users.some(u => u.id === userId)) {
                alert('มีรหัสผู้ใช้นี้อยู่แล้ว!');
                return;
            }
            
            const newUser = {
                id: userId,
                name: userName,
                password: password,
                role: userType
            };
            
            if (userType === 'student') {
                newUser.score = 80;
                newUser.logs = [];
                newUser.class = userClass;
            }
            
            users.push(newUser);
            saveData({ users, allLogs, pendingRequests });
            
            closeModal('addUserModal');
            showAdminPanel();
            alert('เพิ่มผู้ใช้ใหม่เรียบร้อย!');
        }

        // แก้ไขผู้ใช้
        function editUser(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;
            
            document.getElementById('editUserId').value = user.id;
            document.getElementById('editUserName').value = user.name;
            document.getElementById('editUserPassword').value = '';
            
            // ซ่อน/แสดงส่วนระดับชั้นสำหรับนักเรียน
            const classGroup = document.getElementById('editUserClassGroup');
            if (user.role === 'student') {
                classGroup.style.display = 'block';
                document.getElementById('editUserClass').value = user.class || 'ม.1';
            } else {
                classGroup.style.display = 'none';
            }
            
            document.getElementById('editUserModal').style.display = 'flex';
        }

        // อัปเดตผู้ใช้
        function updateUser() {
            const userId = document.getElementById('editUserId').value;
            const userName = document.getElementById('editUserName').value.trim();
            const password = document.getElementById('editUserPassword').value;
            const userClass = document.getElementById('editUserClass').value;
            
            const user = users.find(u => u.id === userId);
            if (user) {
                user.name = userName;
                if (password) {
                    user.password = password;
                }
                
                if (user.role === 'student') {
                    user.class = userClass;
                }
                
                saveData({ users, allLogs, pendingRequests });
                closeModal('editUserModal');
                showAdminPanel();
                alert('บันทึกการเปลี่ยนแปลงเรียบร้อย!');
            }
        }

        // ลบผู้ใช้
        function deleteUser() {
            if (!confirm('คุณแน่ใจหรือไม่ว่าต้องการลบผู้ใช้นี้?')) return;
            
            const userId = document.getElementById('editUserId').value;
            users = users.filter(u => u.id !== userId);
            
            // ลบประวัติที่เกี่ยวข้อง
            if (users.find(u => u.id === userId)?.role === 'student') {
                allLogs = allLogs.filter(log => log.studentId !== userId);
            } else {
                allLogs = allLogs.filter(log => log.actionBy !== userId);
            }
            
            // ลบคำขอที่เกี่ยวข้อง
            pendingRequests = pendingRequests.filter(req => req.requestedBy !== userId && req.studentId !== userId);
            
            saveData({ users, allLogs, pendingRequests });
            closeModal('editUserModal');
            showAdminPanel();
            alert('ลบผู้ใช้เรียบร้อย!');
        }

        // ปิดโมดอล
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // จัดรูปแบบวันที่
        function formatDate(isoString) {
            const date = new Date(isoString);
            return date.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // เริ่มต้นระบบเมื่อโหลดหน้า
        window.onload = function() {
            initializeSystem();
        };
    </script>
</body>
    </html>
